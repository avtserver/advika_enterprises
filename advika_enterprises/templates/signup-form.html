<form class="signup-form" role="form">
    <div class="page-card-body">
        <div class="form-group">
            <label class="form-label sr-only" for="signup_fullname"> {{ _("Full Name") }} </label>
            <input type="text" id="signup_fullname" class="form-control" placeholder="{{ _('Jane Doe') }}"
            required autofocus>
        </div>
        <div class="form-group">
            <label class="form-label sr-only" for="signup_email"> {{ _("Email") }} </label>
            <input type="email" id="signup_email" class="form-control"
            placeholder="{{ _('jane@example.com') }}" required>
        </div>

        <!-- Mobile Number field -->
        <div class="form-group">
            <label class="form-label sr-only" for="signup_mobile_number"> {{ _("Mobile Number") }} </label>
            <input type="text" id="signup_mobile_number" class="form-control"
            placeholder="{{ _('1234567890') }}" required>
        </div>

        <div class="form-group">
            <div class="checkbox">
                <label>
                    <span class="input-area">
                    <input type="checkbox" autocomplete="off" class="input-with-feedback"
                        data-fieldtype="Check" data-fieldname="terms" id="signup-terms" required>
                    </span>
                    <span class="label-area">
                    I have read and agree to your Terms & Conditions
                    </span>
                </label>
            </div>
        </div>
    </div>
    <div class="page-card-actions">
        <button class="btn btn-sm btn-primary btn-block btn-signup"
            type="submit">{{ _("Sign up") }}</button>

        <p class="text-center sign-up-message">
            <a href="#login" class="blue">{{ _("Have an account? Login") }}</a>
        </p>
    </div>
</form>

<script>
    frappe.ready(function () {
        $(".signup-form").on("submit", (e) => {
            signup(e);
        });
    });

    const signup = (e) => {
        e.preventDefault();
        const email = ($("#signup_email").val() || "").trim();
        const full_name = frappe.utils.xss_sanitise(($("#signup_fullname").val() || "").trim());
        const mobile_number = ($("#signup_mobile_number").val() || "").trim();

        if (!email || !validate_email(email) || !full_name || !mobile_number) {
            frappe.msgprint({
                title: __('Signup failed'),
                indicator: 'red',
                message: __('Valid email, name, and mobile number required.')
            });
            return false;
        }

        frappe.call({
            method: "advika_enterprises.overrides.user.sign_up",
            args: {
                "email": email,
                "full_name": full_name,
                "verify_terms": $("#signup-terms").prop("checked") ? 1 : 0,
                "mobile_number": mobile_number
            },
            callback: function(response) {
                if (response.exc) {
                    frappe.msgprint({
                        title: __('Signup failed'),
                        indicator: 'red',
                        message: __('An error occurred during signup. Please try again.')
                    });
                } else {
                    frappe.msgprint({
                        title: __('Success'),
                        indicator: 'green',
                        message: __('Your account has been successfully created. Please check your email for the verification link.')
                    });
                    $('#signup_fullname').val('');
                    $('#signup_email').val('');
                    $('#signup_mobile_number').val('');
                    $('#signup-terms').prop('checked', false);
                }
            },
            error: function() {
                frappe.msgprint({
                    title: __('Signup failed'),
                    indicator: 'red',
                    message: __('An error occurred during signup. Please try again.')
                });
            }
        })
        return false;
    }
</script>
